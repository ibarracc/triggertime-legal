import{f as M,c as o,a as t,b as u,w as c,d as v,A as f,t as m,l as y,F as O,h as j,p as N,G as B,j as _,o as l,x as F}from"./index-CHWeGoxB.js";import{a as g}from"./admin-CUXU3qYV.js";import{A as S}from"./AppInput-BQLXc67T.js";import{A as w}from"./AppModal-lxvFhGNm.js";const $={class:"admin-instances"},z={class:"flex justify-between items-center mb-6"},U={key:0,class:"bg-red-500/10 border border-red-500/20 text-red-500 p-4 rounded-xl mb-6"},G={key:1,class:"flex justify-center p-12"},L={key:2,class:"table-card mt-6 mb-6"},H={class:"table-wrapper"},P={class:"admin-table"},T={class:"font-medium text-sm text-primary"},q={class:"text-xs text-secondary"},J={class:"text-xs"},K={key:0,class:"font-medium text-sm text-primary"},Q={key:0},R={key:1},W={key:1,class:"text-secondary italic"},X={key:0,class:"badge badge-red"},Y={key:1,class:"badge badge-green"},Z={key:0,class:"badge badge-red"},ee={class:"p-4 text-right"},te={class:"flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity"},ae={key:0},se={class:"text-[var(--text-secondary)] mb-6"},le={class:"flex gap-3 justify-end mt-4"},ne={key:0,class:"alert alert-danger"},oe={class:"form-group"},re={class:"mb-4 flex items-center gap-2"},ie={class:"flex gap-3 justify-end mt-4"},pe={__name:"InstancesView",setup(de){const x=_(!0),b=_(""),k=_([]),i=_(null),s=_({isOpen:!1,isEdit:!1,error:"",errors:{},loading:!1}),r=_({id:null,name:"",is_active:!0}),h=async()=>{var n,e;x.value=!0,b.value="";try{const a=await g.getInstances();a.success&&(k.value=a.instances)}catch(a){b.value=((e=(n=a.response)==null?void 0:n.data)==null?void 0:e.message)||"Failed to load instances"}finally{x.value=!1}},A=n=>{i.value=n},I=async()=>{var n,e;if(i.value)try{(await g.deleteInstance(i.value.id)).success&&await h()}catch(a){b.value=((e=(n=a.response)==null?void 0:n.data)==null?void 0:e.message)||"Failed to delete instance"}finally{i.value=null}},D=n=>{r.value={id:n.id,name:n.name,is_active:n.is_active},s.value={isOpen:!0,isEdit:!0,error:"",errors:{},loading:!1}},V=()=>{r.value={id:null,name:"",is_active:!0},s.value={isOpen:!0,isEdit:!1,error:"",errors:{},loading:!1}},C=()=>{s.value.isOpen=!1},E=async()=>{var n,e,a,d;s.value.error="",s.value.errors={},s.value.loading=!0;try{s.value.isEdit?await g.updateInstance(r.value.id,{name:r.value.name,is_active:r.value.is_active}):await g.createInstance({name:r.value.name,is_active:r.value.is_active}),C(),await h()}catch(p){s.value.error=((e=(n=p.response)==null?void 0:n.data)==null?void 0:e.message)||"Action failed",(d=(a=p.response)==null?void 0:a.data)!=null&&d.errors&&(s.value.errors=p.response.data.errors)}finally{s.value.loading=!1}};return M(()=>{h()}),(n,e)=>(l(),o("div",$,[t("div",z,[e[5]||(e[5]=t("h1",{class:"text-2xl font-bold font-heading"},"App Instances",-1)),u(f,{onClick:V,size:"sm"},{default:c(()=>[...e[4]||(e[4]=[v("Add Instance",-1)])]),_:1})]),b.value?(l(),o("div",U,m(b.value),1)):y("",!0),x.value?(l(),o("div",G,[...e[6]||(e[6]=[t("div",{class:"animate-spin h-8 w-8 border-4 border-[var(--primary)] border-t-transparent rounded-full"},null,-1)])])):(l(),o("div",L,[t("div",H,[t("table",P,[e[10]||(e[10]=t("thead",null,[t("tr",null,[t("th",null,"Name (Identifier)"),t("th",null,"Club Admin"),t("th",null,"API Gate"),t("th",null,"Flags"),t("th",{class:"text-right"},"Actions")])],-1)),t("tbody",null,[(l(!0),o(O,null,j(k.value,a=>(l(),o("tr",{key:a.id,class:"hover:bg-white/5 transition-colors group"},[t("td",null,[t("div",T,m(a.name),1),t("div",q,m(a.id),1)]),t("td",J,[a.club_admin?(l(),o("div",K,[a.club_admin.first_name||a.club_admin.last_name?(l(),o("span",Q,m(a.club_admin.first_name)+" "+m(a.club_admin.last_name),1)):(l(),o("span",R,m(a.club_admin.email),1))])):(l(),o("div",W,"Unassigned"))]),t("td",null,[a.is_active?(l(),o("span",Y,"Active")):(l(),o("span",X,"Disabled"))]),t("td",null,[a.deleted_at?(l(),o("span",Z,"Deleted")):y("",!0)]),t("td",ee,[t("div",te,[u(f,{variant:"secondary",size:"sm",onClick:d=>D(a)},{default:c(()=>[...e[7]||(e[7]=[v("Edit",-1)])]),_:1},8,["onClick"]),a.deleted_at?y("",!0):(l(),F(f,{key:0,variant:"secondary",size:"sm",onClick:d=>A(a),class:"text-red-400 hover:text-red-300 border-red-500/30 hover:bg-red-500/10"},{default:c(()=>[...e[8]||(e[8]=[t("svg",{class:"w-4 h-4 mr-2 inline-block",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),v(" Delete ",-1)])]),_:1},8,["onClick"]))])])]))),128)),k.value.length===0?(l(),o("tr",ae,[...e[9]||(e[9]=[t("td",{colspan:"5",class:"p-8 text-center text-secondary"},"No instances found.",-1)])])):y("",!0)])])])])),u(w,{isOpen:!!i.value,title:"Delete Instance",onClose:e[1]||(e[1]=a=>i.value=null)},{default:c(()=>{var a;return[t("p",se,[e[11]||(e[11]=v("Are you sure you want to soft delete instance ",-1)),t("strong",null,m((a=i.value)==null?void 0:a.name),1),e[12]||(e[12]=v("?",-1))]),t("div",le,[u(f,{variant:"secondary",onClick:e[0]||(e[0]=d=>i.value=null)},{default:c(()=>[...e[13]||(e[13]=[v("Cancel",-1)])]),_:1}),t("button",{onClick:I,class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition-colors"}," Confirm Delete ")])]}),_:1},8,["isOpen"]),u(w,{isOpen:s.value.isOpen,title:s.value.isEdit?"Edit Instance":"Create Instance",onClose:C},{default:c(()=>{var a,d;return[s.value.error?(l(),o("div",ne,m(s.value.error),1)):y("",!0),t("div",oe,[e[14]||(e[14]=t("label",{class:"form-label"},"Instance Name",-1)),u(S,{modelValue:r.value.name,"onUpdate:modelValue":e[2]||(e[2]=p=>r.value.name=p),placeholder:"com.example.app",error:(d=(a=s.value.errors)==null?void 0:a.name)==null?void 0:d[0]},null,8,["modelValue","error"])]),t("div",re,[N(t("input",{type:"checkbox",id:"is_active","onUpdate:modelValue":e[3]||(e[3]=p=>r.value.is_active=p),class:"w-4 h-4 rounded bg-[var(--bg-card)] border-[var(--border-subtle)] focus:ring-[var(--primary)] text-[var(--primary)]"},null,512),[[B,r.value.is_active]]),e[15]||(e[15]=t("label",{for:"is_active",class:"text-sm font-medium text-[var(--text-primary)]"},"Active Status",-1))]),t("div",ie,[u(f,{variant:"secondary",onClick:C},{default:c(()=>[...e[16]||(e[16]=[v("Cancel",-1)])]),_:1}),u(f,{onClick:E,loading:s.value.loading},{default:c(()=>[...e[17]||(e[17]=[v("Save Changes",-1)])]),_:1},8,["loading"])])]}),_:1},8,["isOpen","title"])]))}};export{pe as default};
