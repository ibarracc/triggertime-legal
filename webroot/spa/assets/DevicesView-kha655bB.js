import{_ as S,u as T,e as F,f as K,c,a as e,t as i,F as R,h as q,b as a,w as o,i as P,A as r,d as u,p as Z,y as G,z as H,l as B,j as l,o as d,x as J,g as O}from"./index-CHWeGoxB.js";import{d as y}from"./devices-kLDbnci3.js";import{A as Q}from"./AppCard-DwTApDbO.js";import{A as W}from"./AppBadge-CjISbIUR.js";import{A as j}from"./AppModal-lxvFhGNm.js";import{A as X}from"./AppInput-BQLXc67T.js";const Y={class:"devices-view"},ee={class:"header-section devices-header mb-8 flex justify-between items-end"},se={class:"mb-2"},te={class:"text-secondary m-0"},ne={class:"device-count text-right"},ie={class:"text-2xl font-heading font-bold"},le={class:"text-xs text-secondary uppercase tracking-wide"},ae={class:"devices-grid"},oe={class:"flex items-start justify-between mb-4 gap-4"},de={class:"device-info flex gap-4 flex-1 min-w-0"},ce={class:"flex-1 min-w-0"},ue={class:"flex items-center gap-2 mb-1 min-w-0"},re=["onClick","title"],ve=["onClick"],me={class:"text-sm text-secondary truncate"},fe={class:"device-meta text-xs text-secondary mt-4 mb-6 pt-4 border-t border-subtle"},pe={key:0},_e={class:"mt-1 font-mono",style:{"word-break":"break-all"}},ke={class:"p-6"},he={class:"flex justify-end gap-3 mt-6"},ye={class:"p-6"},ge={class:"mb-6 flex gap-4"},we={class:"mt-0 mb-2 font-medium"},xe={class:"flex justify-end gap-3"},be={class:"empty-device-slot"},$e={class:"text-secondary font-medium"},Ce={class:"text-xs text-secondary mt-2 opacity-60"},De={key:1,class:"link-form w-full flex flex-col gap-3 px-4"},Ae=["placeholder"],Me={key:0,class:"text-xs text-danger"},Ve={class:"flex gap-2"},Ue={__name:"DevicesView",setup(Be){T();const{t:z,locale:E}=F(),v=l([]),g=l(null),A=l(!0),w=async()=>{A.value=!0;try{const s=await y.getDevices();s.success&&(v.value=s.devices)}finally{A.value=!1}};K(w);const m=l(!1),x=l(null),p=l(""),b=l(!1),M=s=>{x.value=s,p.value=s.custom_name||"",m.value=!0},L=async()=>{if(x.value){b.value=!0;try{(await y.updateDevice(x.value.device_uuid,{custom_name:p.value})).success&&(await w(),m.value=!1)}finally{b.value=!1}}},f=l(!1),$=l(null),C=l(!1),I=s=>{$.value=s,f.value=!0},N=async()=>{if(!$.value)return;const s=$.value.device_uuid;g.value=s,C.value=!0;try{(await y.unlinkDevice(s)).success&&(v.value=v.value.filter(n=>n.device_uuid!==s),f.value=!1)}finally{g.value=null,C.value=!1}},_=l(!1),k=l(""),D=l(!1),h=l(""),V=async()=>{var s,t;D.value=!0,h.value="";try{(await y.linkDevice(k.value)).success&&(await w(),_.value=!1,k.value="")}catch(n){h.value=((t=(s=n.response)==null?void 0:s.data)==null?void 0:t.message)||z("common.error")}finally{D.value=!1}};return(s,t)=>(d(),c("div",Y,[e("div",ee,[e("div",null,[e("h1",se,i(s.$t("devices.title")),1),e("p",te,i(s.$t("devices.subtitle")),1)]),e("div",ne,[e("div",ie,i(v.value.length),1),e("div",le,i(s.$t("nav.devices")),1)])]),e("div",ae,[(d(!0),c(R,null,q(v.value,n=>(d(),J(Q,{key:n.id,class:"device-card min-w-0"},{default:o(()=>[e("div",oe,[e("div",de,[t[8]||(t[8]=e("div",{class:"device-icon shrink-0"},"ðŸ“±",-1)),e("div",ce,[e("div",ue,[n.custom_name?(d(),c("h3",{key:0,class:"font-heading text-lg m-0 cursor-pointer hover:text-primary transition-colors truncate flex-1 min-w-0 block w-full",onClick:U=>M(n),title:n.custom_name},i(n.custom_name),9,re)):(d(),c("h3",{key:1,class:"font-heading text-sm m-0 text-primary cursor-pointer hover:underline whitespace-nowrap truncate flex-1 min-w-0 block w-full",onClick:U=>M(n)}," Add custom name ",8,ve))]),e("div",me,i(n.hardware_model||"Unknown Model"),1)])]),a(W,{variant:"success",class:"shrink-0"},{default:o(()=>[u(i(s.$t("dashboard.active")),1)]),_:1})]),e("div",fe,[n.first_activation_date?(d(),c("div",pe,"Added: "+i(new Date(n.first_activation_date).toLocaleDateString(O(E))),1)):B("",!0),e("div",_e,"ID: "+i(n.device_uuid),1)]),a(r,{variant:"danger",size:"sm",class:"w-full mt-4",onClick:U=>I(n),loading:g.value===n.device_uuid},{default:o(()=>[u(i(s.$t("devices.unlink")),1)]),_:1},8,["onClick","loading"])]),_:2},1024))),128)),a(j,{"is-open":m.value,onClose:t[2]||(t[2]=n=>m.value=!1),title:s.$t("devices.edit_device"),size:"sm"},{default:o(()=>[e("div",ke,[e("form",{onSubmit:P(L,["prevent"])},[a(X,{modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=n=>p.value=n),label:s.$t("devices.custom_name_label"),placeholder:"My Phone",required:""},null,8,["modelValue","label"]),e("div",he,[a(r,{variant:"secondary",onClick:t[1]||(t[1]=n=>m.value=!1)},{default:o(()=>[u(i(s.$t("common.cancel")),1)]),_:1}),a(r,{type:"submit",loading:b.value},{default:o(()=>[u(i(s.$t("common.save")),1)]),_:1},8,["loading"])])],32)])]),_:1},8,["is-open","title"]),a(j,{"is-open":f.value,onClose:t[4]||(t[4]=n=>f.value=!1),title:s.$t("devices.unlink"),size:"sm"},{default:o(()=>[e("div",ye,[e("div",ge,[t[9]||(t[9]=e("div",{class:"text-danger mt-1"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"}),e("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),e("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})])],-1)),e("div",null,[e("p",we,i(s.$t("devices.unlink_confirm")),1)])]),e("div",xe,[a(r,{variant:"secondary",onClick:t[3]||(t[3]=n=>f.value=!1)},{default:o(()=>[u(i(s.$t("common.cancel")),1)]),_:1}),a(r,{variant:"danger",onClick:N,loading:C.value},{default:o(()=>[u(i(s.$t("devices.unlink")),1)]),_:1},8,["loading"])])])]),_:1},8,["is-open","title"]),e("div",be,[t[11]||(t[11]=e("div",{class:"empty-icon text-secondary mb-3"},"â¨",-1)),_.value?(d(),c("div",De,[Z(e("input",{"onUpdate:modelValue":t[6]||(t[6]=n=>k.value=n),class:"token-input",placeholder:s.$t("devices.token_placeholder"),maxlength:"6",onKeyup:H(V,["enter"])},null,40,Ae),[[G,k.value]]),h.value?(d(),c("div",Me,i(h.value),1)):B("",!0),e("div",Ve,[a(r,{size:"sm",class:"flex-1",onClick:V,loading:D.value},{default:o(()=>[u(i(s.$t("devices.link_button")),1)]),_:1},8,["loading"]),a(r,{size:"sm",variant:"secondary",onClick:t[7]||(t[7]=n=>_.value=!1)},{default:o(()=>[...t[10]||(t[10]=[u("âœ•",-1)])]),_:1})])])):(d(),c("div",{key:0,onClick:t[5]||(t[5]=n=>_.value=!0),style:{cursor:"pointer"}},[e("div",$e,i(s.$t("devices.link_new")),1),e("div",Ce,i(s.$t("devices.token_help")),1)]))])])]))}},Se=S(Ue,[["__scopeId","data-v-49482d17"]]);export{Se as default};
