import{_ as E,f as G,c as a,a as t,b as v,w as p,d as g,A as y,t as c,l as x,F as V,h as A,p as M,v as N,s as K,j as f,D as T,r as H,o as l}from"./index-CHWeGoxB.js";import{a as b}from"./admin-CUXU3qYV.js";import{A as I}from"./AppModal-lxvFhGNm.js";const P={class:"admin-configs"},q={class:"flex justify-between items-center mb-6"},Q={key:0,class:"bg-red-500/10 border border-red-500/20 text-red-500 p-4 rounded-xl mb-6"},W={key:1,class:"flex justify-center p-12"},X={key:2,class:"table-card mt-6 mb-6"},Y={class:"table-wrapper"},Z={class:"admin-table"},ee={class:"font-medium text-sm text-primary"},te={key:0,class:"text-secondary"},se={key:1,class:"text-secondary italic"},oe={class:"text-secondary"},ne={class:"text-secondary text-sm"},ae={class:"p-4 text-right"},le={class:"flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity"},re={key:0},ie={class:"flex gap-3 justify-end mt-4"},de={key:0,class:"alert alert-danger"},ue={class:"form-group"},ce=["value"],ve={key:0,class:"text-red-500 text-xs mt-1"},pe={class:"form-group mt-4"},fe=["disabled"],me=["value"],ge={key:0,class:"text-red-500 text-xs mt-1"},ye={class:"form-group mt-4"},_e={class:"flex gap-3 justify-end mt-6"},xe={__name:"RemoteConfigsView",setup(be){const C=f(!0),_=f(""),k=f([]),O=f([]),j=f([]),m=f(null),n=f({isOpen:!1,error:"",errors:{},loading:!1}),d=f({instance_id:null,version_id:null,config_data:{}}),S=T(()=>d.value.instance_id?j.value.filter(o=>o.instance_id===d.value.instance_id):[]),F=o=>{if(!o)return 0;try{const e=JSON.parse(o);return Object.keys(e).length}catch{return 0}},h=async()=>{var o,e;C.value=!0,_.value="";try{const r=await b.getRemoteConfigs();r.success&&(k.value=r.configs);const s=await b.getInstances();s.success&&(O.value=s.instances);const i=await K.get("/admin/versions");i.success&&(j.value=i.versions)}catch(r){_.value=((e=(o=r.response)==null?void 0:o.data)==null?void 0:e.message)||"Failed to load configs"}finally{C.value=!1}},B=o=>{m.value=o},J=async()=>{var o,e;if(m.value)try{(await b.deleteRemoteConfig(m.value.id)).success&&await h()}catch(r){_.value=((e=(o=r.response)==null?void 0:o.data)==null?void 0:e.message)||"Failed to delete config"}finally{m.value=null}},L=()=>{d.value={instance_id:null,version_id:null,config_data:{}},n.value={isOpen:!0,error:"",errors:{},loading:!1}},U=()=>{d.value.version_id=null},$=o=>{const e=o.target.files[0];if(!e)return;const r=new FileReader;r.onload=s=>{try{const i=JSON.parse(s.target.result);d.value.config_data=i}catch{n.value.error="Invalid JSON file selected."}},r.readAsText(e)},w=()=>{n.value.isOpen=!1},z=async()=>{var o,e,r,s;n.value.error="",n.value.errors={},n.value.loading=!0;try{await b.createRemoteConfig(d.value),w(),await h()}catch(i){n.value.error=((e=(o=i.response)==null?void 0:o.data)==null?void 0:e.message)||"Action failed",(s=(r=i.response)==null?void 0:r.data)!=null&&s.errors&&(n.value.errors=i.response.data.errors)}finally{n.value.loading=!1}};return G(()=>{h()}),(o,e)=>{const r=H("router-link");return l(),a("div",P,[t("div",q,[e[5]||(e[5]=t("h1",{class:"text-2xl font-bold font-heading"},"Remote Configs",-1)),v(y,{onClick:L,size:"sm"},{default:p(()=>[...e[4]||(e[4]=[g("Add Config",-1)])]),_:1})]),_.value?(l(),a("div",Q,c(_.value),1)):x("",!0),C.value?(l(),a("div",W,[...e[6]||(e[6]=[t("div",{class:"animate-spin h-8 w-8 border-4 border-[var(--primary)] border-t-transparent rounded-full"},null,-1)])])):(l(),a("div",X,[t("div",Y,[t("table",Z,[e[10]||(e[10]=t("thead",null,[t("tr",null,[t("th",null,"App Instance"),t("th",null,"Version"),t("th",null,"Keys"),t("th",null,"Last Modified"),t("th",{class:"text-right"},"Actions")])],-1)),t("tbody",null,[(l(!0),a(V,null,A(k.value,s=>(l(),a("tr",{key:s.id,class:"hover:bg-white/5 transition-colors group"},[t("td",null,[t("div",ee,c(s.instance?s.instance.name:s.app_instance),1)]),t("td",null,[s.version?(l(),a("div",te," v"+c(s.version.version),1)):(l(),a("div",se,"Global (All Versions)"))]),t("td",null,[t("div",oe,c(F(s.config_data))+" keys (+ legacy flags) ",1)]),t("td",null,[t("div",ne,c(new Date(s.modified).toLocaleDateString()),1)]),t("td",ae,[t("div",le,[v(r,{to:`/admin/remote-configs/${s.id}`},{default:p(()=>[v(y,{variant:"secondary",size:"sm"},{default:p(()=>[...e[7]||(e[7]=[g("View / Edit",-1)])]),_:1})]),_:1},8,["to"]),v(y,{variant:"secondary",size:"sm",onClick:i=>B(s),class:"text-red-400 hover:text-red-300 border-red-500/30 hover:bg-red-500/10"},{default:p(()=>[...e[8]||(e[8]=[t("svg",{class:"w-4 h-4 mr-2 inline-block",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),g(" Delete ",-1)])]),_:1},8,["onClick"])])])]))),128)),k.value.length===0?(l(),a("tr",re,[...e[9]||(e[9]=[t("td",{colspan:"5",class:"p-8 text-center text-secondary"},"No remote configs found.",-1)])])):x("",!0)])])])])),v(I,{isOpen:!!m.value,title:"Delete Config",onClose:e[1]||(e[1]=s=>m.value=null)},{default:p(()=>[e[12]||(e[12]=t("p",{class:"text-[var(--text-secondary)] mb-6"},"Are you sure you want to delete this remote config payload?",-1)),t("div",ie,[v(y,{variant:"secondary",onClick:e[0]||(e[0]=s=>m.value=null)},{default:p(()=>[...e[11]||(e[11]=[g("Cancel",-1)])]),_:1}),t("button",{onClick:J,class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition-colors"}," Confirm Delete ")])]),_:1},8,["isOpen"]),v(I,{isOpen:n.value.isOpen,title:"Create Remote Config",onClose:w},{default:p(()=>{var s,i,D,R;return[n.value.error?(l(),a("div",de,c(n.value.error),1)):x("",!0),t("div",ue,[e[14]||(e[14]=t("label",{class:"form-label"},"Instance",-1)),M(t("select",{"onUpdate:modelValue":e[2]||(e[2]=u=>d.value.instance_id=u),class:"form-select text-black",onChange:U},[e[13]||(e[13]=t("option",{value:null},"-- Select Instance --",-1)),(l(!0),a(V,null,A(O.value,u=>(l(),a("option",{key:u.id,value:u.id},c(u.name),9,ce))),128))],544),[[N,d.value.instance_id]]),(i=(s=n.value.errors)==null?void 0:s.instance_id)!=null&&i[0]?(l(),a("div",ve,c(n.value.errors.instance_id[0]),1)):x("",!0)]),t("div",pe,[e[16]||(e[16]=t("label",{class:"form-label"},"Version (Optional)",-1)),M(t("select",{"onUpdate:modelValue":e[3]||(e[3]=u=>d.value.version_id=u),class:"form-select text-black",disabled:!d.value.instance_id},[e[15]||(e[15]=t("option",{value:null},"Global (All versions for this instance)",-1)),(l(!0),a(V,null,A(S.value,u=>(l(),a("option",{key:u.id,value:u.id},"v"+c(u.version),9,me))),128))],8,fe),[[N,d.value.version_id]]),(R=(D=n.value.errors)==null?void 0:D.version_id)!=null&&R[0]?(l(),a("div",ge,c(n.value.errors.version_id[0]),1)):x("",!0)]),t("div",ye,[e[17]||(e[17]=t("label",{class:"form-label"},"Initial JSON Payload",-1)),e[18]||(e[18]=t("p",{class:"text-xs text-secondary mb-2"},"Upload a .json file to populate initial config values",-1)),t("input",{type:"file",accept:".json",onChange:$,class:"form-input text-secondary"},null,32)]),t("div",_e,[v(y,{variant:"secondary",onClick:w},{default:p(()=>[...e[19]||(e[19]=[g("Cancel",-1)])]),_:1}),v(y,{onClick:z,loading:n.value.loading},{default:p(()=>[...e[20]||(e[20]=[g("Create Config",-1)])]),_:1},8,["loading"])])]}),_:1},8,["isOpen"])])}}},we=E(xe,[["__scopeId","data-v-858022cc"]]);export{we as default};
