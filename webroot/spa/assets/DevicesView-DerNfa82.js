import{a as w}from"./admin-CUXU3qYV.js";import{f as V,c as n,a as s,t as r,l as x,F as N,h as j,b as c,w as m,d as v,A as y,j as p,o as l,x as B}from"./index-CHWeGoxB.js";import{A as E}from"./AppInput-BQLXc67T.js";import{A as C}from"./AppModal-lxvFhGNm.js";const F={class:"admin-devices"},U={key:0,class:"bg-red-500/10 border border-red-500/20 text-red-500 p-4 rounded-xl mb-6"},$={key:1,class:"flex justify-center p-12"},I={key:2,class:"table-card mt-6 mb-6"},S={class:"table-wrapper"},z={class:"admin-table"},L={class:"font-mono text-sm tracking-wider text-primary"},G={class:"text-xs text-secondary"},H={class:"font-medium"},T={class:"text-xs text-secondary"},q={class:"text-sm"},J={key:0,class:"font-medium text-primary"},K={key:0},P={key:1},Q={key:1,class:"text-secondary"},R={class:"text-sm"},W={class:"text-right"},X={class:"flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity"},Y={key:0},Z={class:"text-[var(--text-secondary)] mb-6"},ee={class:"flex gap-3 justify-end mt-4"},te={key:0,class:"alert alert-danger"},se={class:"form-group"},ae={class:"flex gap-4 justify-end mt-6"},de={__name:"DevicesView",setup(oe){const g=p(!0),f=p(""),b=p([]),d=p(null),o=p({isOpen:!1,error:"",errors:{},loading:!1}),_=p({id:null,custom_name:""}),k=async()=>{var a,e;g.value=!0,f.value="";try{const t=await w.getDevices();t.success&&(b.value=t.devices)}catch(t){f.value=((e=(a=t.response)==null?void 0:a.data)==null?void 0:e.message)||"Failed to load devices"}finally{g.value=!1}},D=a=>{d.value=a},A=async()=>{var a,e;if(d.value)try{(await w.deleteDevice(d.value.id)).success&&await k()}catch(t){f.value=((e=(a=t.response)==null?void 0:a.data)==null?void 0:e.message)||"Failed to delete device"}finally{d.value=null}},M=a=>{_.value={id:a.id,custom_name:a.custom_name||""},o.value={isOpen:!0,error:"",errors:{},loading:!1}},h=()=>{o.value.isOpen=!1},O=async()=>{var a,e,t,i;o.value.error="",o.value.errors={},o.value.loading=!0;try{await w.updateDevice(_.value.id,{custom_name:_.value.custom_name}),h(),await k()}catch(u){o.value.error=((e=(a=u.response)==null?void 0:a.data)==null?void 0:e.message)||"Update failed",(i=(t=u.response)==null?void 0:t.data)!=null&&i.errors&&(o.value.errors=u.response.data.errors)}finally{o.value.loading=!1}};return V(()=>{k()}),(a,e)=>(l(),n("div",F,[e[14]||(e[14]=s("div",{class:"flex justify-between items-center mb-6"},[s("h1",{class:"text-2xl font-bold font-heading"},"Devices Management")],-1)),f.value?(l(),n("div",U,r(f.value),1)):x("",!0),g.value?(l(),n("div",$,[...e[3]||(e[3]=[s("div",{class:"animate-spin h-8 w-8 border-4 border-[var(--primary)] border-t-transparent rounded-full"},null,-1)])])):(l(),n("div",I,[s("div",S,[s("table",z,[e[7]||(e[7]=s("thead",null,[s("tr",null,[s("th",null,"UUID"),s("th",null,"Model"),s("th",null,"Owner"),s("th",null,"Instance"),s("th",{class:"text-right"},"Actions")])],-1)),s("tbody",null,[(l(!0),n(N,null,j(b.value,t=>{var i;return l(),n("tr",{key:t.id,class:"hover:bg-white/5 transition-colors group"},[s("td",null,[s("div",L,r(t.device_uuid),1),s("div",G,r(t.platform)+" v"+r(t.os_version),1)]),s("td",null,[s("div",H,r(t.hardware_model),1),s("div",T,r(t.custom_name||"-"),1)]),s("td",q,[t.user?(l(),n("div",J,[t.user.first_name||t.user.last_name?(l(),n("span",K,r(t.user.first_name)+" "+r(t.user.last_name),1)):(l(),n("span",P,r(t.user.email),1))])):(l(),n("div",Q,"N/A"))]),s("td",R,r(((i=t.instance)==null?void 0:i.name)||"Global"),1),s("td",W,[s("div",X,[c(y,{variant:"secondary",size:"sm",onClick:u=>M(t)},{default:m(()=>[...e[4]||(e[4]=[v("Edit",-1)])]),_:1},8,["onClick"]),t.deleted_at?x("",!0):(l(),B(y,{key:0,variant:"secondary",size:"sm",onClick:u=>D(t),class:"text-red-400 hover:text-red-300 border-red-500/30 hover:bg-red-500/10"},{default:m(()=>[...e[5]||(e[5]=[s("svg",{class:"w-4 h-4 mr-2 inline-block",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),v(" Delete ",-1)])]),_:1},8,["onClick"]))])])])}),128)),b.value.length===0?(l(),n("tr",Y,[...e[6]||(e[6]=[s("td",{colspan:"5",class:"p-8 text-center text-secondary"},"No devices found.",-1)])])):x("",!0)])])])])),c(C,{isOpen:!!d.value,title:"Delete Device",onClose:e[1]||(e[1]=t=>d.value=null)},{default:m(()=>{var t;return[s("p",Z,[e[8]||(e[8]=v("Are you sure you want to soft delete device ",-1)),s("strong",null,r((t=d.value)==null?void 0:t.device_uuid),1),e[9]||(e[9]=v("?",-1))]),s("div",ee,[c(y,{variant:"secondary",onClick:e[0]||(e[0]=i=>d.value=null)},{default:m(()=>[...e[10]||(e[10]=[v("Cancel",-1)])]),_:1}),s("button",{onClick:A,class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition-colors"}," Confirm Delete ")])]}),_:1},8,["isOpen"]),c(C,{isOpen:o.value.isOpen,title:"Edit Device",onClose:h},{default:m(()=>{var t,i;return[o.value.error?(l(),n("div",te,r(o.value.error),1)):x("",!0),s("div",se,[e[11]||(e[11]=s("label",{class:"form-label"},"Custom Name",-1)),c(E,{modelValue:_.value.custom_name,"onUpdate:modelValue":e[2]||(e[2]=u=>_.value.custom_name=u),placeholder:"Device Name",error:(i=(t=o.value.errors)==null?void 0:t.custom_name)==null?void 0:i[0]},null,8,["modelValue","error"])]),s("div",ae,[c(y,{variant:"secondary",onClick:h},{default:m(()=>[...e[12]||(e[12]=[v("Cancel",-1)])]),_:1}),c(y,{onClick:O,loading:o.value.loading},{default:m(()=>[...e[13]||(e[13]=[v("Save Changes",-1)])]),_:1},8,["loading"])])]}),_:1},8,["isOpen"])]))}};export{de as default};
