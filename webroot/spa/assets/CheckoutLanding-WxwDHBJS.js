import{_ as N,u as S,f as M,s as h,c as s,b as l,w as r,a as t,t as y,A as u,d as a,g,l as A,n as V,j as d,m as Y,o}from"./index-CHWeGoxB.js";import{A as j}from"./AppCard-DwTApDbO.js";import{A as E}from"./AppBadge-CjISbIUR.js";import{d as F}from"./devices-kLDbnci3.js";const I={class:"container checkout-landing-container"},q={key:0,class:"text-center py-8"},U={key:1,class:"text-center py-8"},$={class:"text-secondary mb-6"},G={key:2,class:"text-center py-8"},H={class:"text-secondary mb-8"},J={key:3,class:"text-center"},K={key:0,class:"inline-block mb-4"},O={class:"text-secondary mb-8"},Q={class:"text-primary"},W={key:1},X={key:0},Z={key:1},ee={class:"bg-elevated p-8 rounded-xl border border-subtle mb-6 text-center"},te={key:0,class:"alert alert-danger mt-4 text-left"},se={key:2},oe={key:0,class:"flex flex-col gap-4"},ne={key:1,class:"flex flex-col gap-4"},ie={__name:"CheckoutLanding",setup(ae){const P=V(),k=Y(),m=S(),b=d(!0),v=d(""),C=d(null),c=P.params.token,_=d(!1);M(async()=>{var n,e;if(!c){v.value="No token provided in the URL.",b.value=!1;return}try{const i=await h.get(`/web/tokens/${c}/verify`);if(i.success&&(C.value={uuid:i.device_uuid},m.isAuthenticated)){const w=await F.getDevices();w.success&&w.devices&&(_.value=w.devices.some(z=>z.device_uuid===i.device_uuid))}}catch(i){v.value=((e=(n=i.response)==null?void 0:n.data)==null?void 0:e.message)||"The upgrade link has expired. Please generate a new one from the app."}finally{b.value=!1}});const L=()=>{k.push({path:"/register",query:{upgrade_token:c}})},T=()=>{k.push({path:"/login",query:{upgrade_token:c}})},p=d(!1),D=async()=>{p.value=!0;try{const n=await h.post("/web/subscriptions/checkout",{upgrade_token:c});n.success&&n.url&&(window.location.href=n.url)}catch{v.value="Failed to initiate checkout. Please try again."}finally{p.value=!1}},x=d(""),f=d(""),R=async()=>{var n,e;p.value=!0,f.value="";try{(await h.post("/web/devices/link-upgrade-token",{upgrade_token:c})).success&&(x.value="Your device has been linked to your account. You can now close this window or return to your dashboard.")}catch(i){f.value=((e=(n=i.response)==null?void 0:n.data)==null?void 0:e.message)||"Failed to link device. Please try again."}finally{p.value=!1}},B=()=>{window.location.href="triggertime://",setTimeout(()=>{alert("Please close this window and generate a new link from the TriggerTime application.")},500)};return(n,e)=>(o(),s("div",I,[l(j,{class:"checkout-card"},{default:r(()=>{var i;return[b.value?(o(),s("div",q,[...e[2]||(e[2]=[t("div",{class:"spinner mx-auto mb-4"},null,-1),t("p",{class:"text-secondary"},"Validating secure token...",-1)])])):v.value?(o(),s("div",U,[e[4]||(e[4]=t("div",{class:"state-icon text-warning mb-4"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-16 h-16 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),e[5]||(e[5]=t("h2",{class:"mb-2"},"Link Expired",-1)),t("p",$,y(v.value),1),l(u,{onClick:B,class:"w-full"},{default:r(()=>[...e[3]||(e[3]=[a(" Return to App ",-1)])]),_:1})])):x.value?(o(),s("div",G,[e[7]||(e[7]=t("div",{class:"state-icon text-success mb-4"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-16 h-16 mx-auto",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e[8]||(e[8]=t("h2",{class:"mb-2"},"Device Linked Successfully",-1)),t("p",H,y(x.value),1),l(u,{onClick:e[0]||(e[0]=()=>g(k).push("/dashboard/devices")),class:"w-full",size:"lg"},{default:r(()=>[...e[6]||(e[6]=[a(" Return to Dashboard ",-1)])]),_:1})])):(o(),s("div",J,[g(m).isProPlus?A("",!0):(o(),s("div",K,[l(E,{variant:"primary"},{default:r(()=>[...e[9]||(e[9]=[a("Upgrade to Pro+",-1)])]),_:1})])),e[21]||(e[21]=t("h1",{class:"mb-2"},"Link Your Device",-1)),t("p",O,[e[10]||(e[10]=a(" You're linking ",-1)),t("strong",Q,y(((i=C.value)==null?void 0:i.model)||"your device"),1),e[11]||(e[11]=a(" to a Pro+ subscription. ",-1))]),g(m).isProPlus?(o(),s("div",W,[_.value?(o(),s("div",X,[e[13]||(e[13]=t("div",{class:"bg-elevated p-8 rounded-xl border border-subtle mb-6 text-center text-success bg-opacity-10 border-success"},[t("h3",{class:"font-heading text-lg mb-2 text-success"},"Device Already Linked"),t("p",{class:"text-secondary m-0"},"This device is already connected to your TriggerTime account.")],-1)),l(u,{onClick:e[1]||(e[1]=()=>g(k).push("/dashboard/devices")),class:"w-full mb-4",size:"lg"},{default:r(()=>[...e[12]||(e[12]=[a(" Return to Dashboard ",-1)])]),_:1})])):(o(),s("div",Z,[t("div",ee,[e[14]||(e[14]=t("h3",{class:"font-heading text-lg mb-2 text-primary"},"Active Subscription Found!",-1)),e[15]||(e[15]=t("p",{class:"text-secondary mb-0"},"You already have an active Pro+ subscription. Click below to securely link this device to your account.",-1)),f.value?(o(),s("div",te,y(f.value),1)):A("",!0)]),l(u,{onClick:R,class:"w-full mb-4",size:"lg",loading:p.value},{default:r(()=>[...e[16]||(e[16]=[a(" Link Device Now ",-1)])]),_:1},8,["loading"])]))])):(o(),s("div",se,[e[20]||(e[20]=t("div",{class:"bg-elevated p-6 pt-6 rounded-lg border border-subtle mb-8 text-left"},[t("h3",{class:"font-heading text-lg mb-4 text-center"},"Next Steps:"),t("ol",{class:"step-list text-secondary"},[t("li",null,"Create an account or log in to an existing one."),t("li",null,"Complete your Pro+ subscription checkout."),t("li",null,"Return to the app to automatically unlock premium features.")])],-1)),g(m).isAuthenticated?(o(),s("div",oe,[l(u,{onClick:D,class:"w-full",size:"lg",loading:p.value},{default:r(()=>[...e[17]||(e[17]=[a(" Complete Pro+ Checkout ",-1)])]),_:1},8,["loading"])])):(o(),s("div",ne,[l(u,{onClick:L,class:"w-full",size:"lg"},{default:r(()=>[...e[18]||(e[18]=[a(" Create Account & Checkout ",-1)])]),_:1}),l(u,{variant:"ghost",onClick:T,class:"w-full"},{default:r(()=>[...e[19]||(e[19]=[a(" I already have an account ",-1)])]),_:1})]))]))]))]}),_:1})]))}},ce=N(ie,[["__scopeId","data-v-bb48e2ce"]]);export{ce as default};
