import{_ as K,f as z,c as l,a as e,b as y,w as b,x as E,d as x,A as _,l as V,t as d,F as S,h as J,H as T,n as $,r as G,j as v,D as H,m as Y,o as a,C as k}from"./index-CHWeGoxB.js";import{a as D}from"./admin-CUXU3qYV.js";const q={class:"admin-config-detail"},P={class:"flex items-center justify-between mb-8"},Q={class:"flex items-center gap-4"},W={class:"flex gap-2"},X={key:0,class:"flex justify-center p-12"},Z={key:1,class:"bg-red-500/10 border border-red-500/20 text-red-500 p-4 rounded-xl mb-6"},ee={key:2,class:"grid grid-cols-1 lg:grid-cols-4 gap-4 lg:gap-5"},te={class:"lg:col-span-1 space-y-6"},se={class:"glass-card"},ae={class:"space-y-4"},le=["title"],oe={key:0,class:"font-medium"},ne={key:1,class:"font-medium text-secondary italic"},de={class:"pt-4 border-t border-[var(--border-subtle)]"},ie={class:"text-sm font-mono text-[10px]"},re={class:"text-sm font-mono text-[10px]"},ce={class:"glass-card mt-8"},ue={class:"flex items-center justify-between mb-3"},fe={class:"relative"},ve={class:"lg:col-span-3 min-w-0 overflow-hidden"},pe={key:0,class:"glass-card overflow-hidden h-full"},me={class:"config-table"},be={class:"key-cell"},ge={class:"value-cell"},ye={key:0,class:"value-pre"},xe={key:2},_e={key:0},ke={key:1,class:"glass-card h-full border-primary/50 shadow-glow overflow-hidden"},he={class:"diff-table"},we={class:"diff-key-cell"},Ce={class:"diff-value-cell"},Ve={class:"diff-value-inner"},je={key:0,class:"value-pre"},Ne={key:1,class:"text-secondary italic"},Oe={key:3},Re={class:"diff-value-cell"},Se={class:"diff-value-inner"},Je={key:0,class:"value-pre"},De={key:1,class:"text-secondary italic"},Ie={key:3},Ae={key:0},Be={class:"flex gap-4 justify-end mt-6"},Fe={__name:"RemoteConfigDetailView",setup(Me){const I=$();Y();const j=I.params.id,h=v(!0),w=v(!1),u=v(""),r=v({}),c=v({}),p=v(!1),f=v(null),C=v(null),N=async()=>{var n,t;h.value=!0,u.value="";try{const o=await D.getRemoteConfig(j);if(o.success)if(r.value=o.config,o.config.config_data)try{c.value=JSON.parse(o.config.config_data)}catch{c.value={error:"Failed to parse JSON"}}else c.value={}}catch(o){u.value=((t=(n=o.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to load config detail"}finally{h.value=!1}},A=()=>{var i;const n=JSON.stringify(c.value,null,2),t="data:application/json;charset=utf-8,"+encodeURIComponent(n),o=`config_${((i=r.value.instance)==null?void 0:i.name)||"export"}.json`,s=document.createElement("a");s.setAttribute("href",t),s.setAttribute("download",o),s.click()},B=n=>{const t=n.target.files[0];if(!t)return;const o=new FileReader;o.onload=s=>{try{const i=s.target.result;f.value=JSON.parse(i),p.value=!0}catch{u.value="Invalid JSON file selected.",setTimeout(()=>{u.value=""},3e3)}finally{C.value.value=""}},o.readAsText(t)},F=()=>{p.value=!1,f.value=null},M=async()=>{var n,t;w.value=!0,u.value="";try{const o={config_data:f.value};await D.updateRemoteConfig(j,o),await N(),p.value=!1,f.value=null}catch(o){u.value=((t=(n=o.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to save changes"}finally{w.value=!1}},O=n=>n===void 0?"—":typeof n=="object"&&n!==null?JSON.stringify(n,null,2):String(n),R=H(()=>{if(!p.value||!f.value)return[];const n=new Set([...Object.keys(c.value),...Object.keys(f.value)]);return Array.from(n).sort().map(t=>{const o=t in c.value,s=t in f.value,i=o?c.value[t]:void 0,m=s?f.value[t]:void 0,U=O(i),L=O(m);let g="";return o&&s?JSON.stringify(i)!==JSON.stringify(m)&&(g="diff-changed"):o&&!s?g="diff-removed":g="diff-added",{key:t,oldValue:U,newValue:L,oldRaw:i,newRaw:m,oldIsObject:typeof i=="object"&&i!==null,newIsObject:typeof m=="object"&&m!==null,rowClass:g}})});return z(()=>{N()}),(n,t)=>{const o=G("router-link");return a(),l("div",q,[e("div",P,[e("div",Q,[y(o,{to:"/admin/remote-configs",class:"text-secondary hover:text-primary transition-colors"},{default:b(()=>[...t[1]||(t[1]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),_:1}),t[2]||(t[2]=e("h1",{class:"text-2xl font-bold font-heading"},"Remote Config Detail",-1))]),e("div",W,[p.value?V("",!0):(a(),E(_,{key:0,variant:"secondary",size:"sm",onClick:A},{default:b(()=>[...t[3]||(t[3]=[e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),x(" Download JSON ",-1)])]),_:1}))])]),h.value?(a(),l("div",X,[...t[4]||(t[4]=[e("div",{class:"animate-spin h-8 w-8 border-4 border-[var(--primary)] border-t-transparent rounded-full"},null,-1)])])):u.value?(a(),l("div",Z,d(u.value),1)):(a(),l("div",ee,[e("div",te,[e("div",se,[t[9]||(t[9]=e("h2",{class:"text-lg font-semibold mb-4 text-primary"},"Metadata",-1)),e("div",ae,[e("div",null,[t[5]||(t[5]=e("div",{class:"text-xs text-secondary uppercase tracking-wider mb-1"},"Instance",-1)),e("div",{class:"font-medium truncate",title:r.value.instance?r.value.instance.name:r.value.app_instance},d(r.value.instance?r.value.instance.name:r.value.app_instance),9,le)]),e("div",null,[t[6]||(t[6]=e("div",{class:"text-xs text-secondary uppercase tracking-wider mb-1"},"Version",-1)),r.value.version?(a(),l("div",oe,"v"+d(r.value.version.version),1)):(a(),l("div",ne,"Global (All Versions)"))]),e("div",de,[t[7]||(t[7]=e("div",{class:"text-xs text-secondary mb-1"},"Created",-1)),e("div",ie,d(new Date(r.value.created).toLocaleString()),1)]),e("div",null,[t[8]||(t[8]=e("div",{class:"text-xs text-secondary mb-1"},"Last Modified",-1)),e("div",re,d(new Date(r.value.modified).toLocaleString()),1)])])]),e("div",ce,[e("div",ue,[t[11]||(t[11]=e("h2",{class:"text-lg font-semibold text-primary"},"Update Config",-1)),e("div",fe,[e("input",{type:"file",ref_key:"fileInputRef",ref:C,accept:".json",class:"hidden",onChange:B},null,544),y(_,{variant:"primary",size:"sm",onClick:t[0]||(t[0]=s=>C.value.click())},{default:b(()=>[...t[10]||(t[10]=[e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})],-1),x(" Upload JSON ",-1)])]),_:1})])]),t[12]||(t[12]=e("p",{class:"text-[11px] text-secondary leading-relaxed"},"Upload a new JSON file to replace the current configuration. You'll be able to review differences before saving.",-1))])]),e("div",ve,[p.value?(a(),l("div",ke,[t[22]||(t[22]=T('<div class="flex justify-between items-center mb-6 border-b border-[var(--border-subtle)] pb-4" data-v-bd0e7908><div data-v-bd0e7908><h2 class="text-lg font-semibold text-primary" data-v-bd0e7908>Review Changes</h2><p class="text-sm text-secondary" data-v-bd0e7908>Review the differences before confirming update.</p></div><div class="flex gap-4 text-xs font-mono bg-[var(--bg-base)] p-3 rounded-lg border border-[var(--border-subtle)]" data-v-bd0e7908><div class="flex items-center gap-2" data-v-bd0e7908><span class="w-2.5 h-2.5 rounded-sm" style="background-color:#4ade80;" data-v-bd0e7908></span><span class="text-secondary" data-v-bd0e7908>Added</span></div><div class="flex items-center gap-2" data-v-bd0e7908><span class="w-2.5 h-2.5 rounded-sm" style="background-color:#f87171;" data-v-bd0e7908></span><span class="text-secondary" data-v-bd0e7908>Removed</span></div><div class="flex items-center gap-2" data-v-bd0e7908><span class="w-2.5 h-2.5 rounded-sm" style="background-color:#facc15;" data-v-bd0e7908></span><span class="text-secondary" data-v-bd0e7908>Changed</span></div></div></div>',1)),e("table",he,[t[18]||(t[18]=e("colgroup",null,[e("col",{class:"diff-key-col"}),e("col",{class:"diff-value-col"}),e("col",{class:"diff-value-col"})],-1)),t[19]||(t[19]=e("thead",null,[e("tr",null,[e("th",null,"Key"),e("th",null,"Old Value"),e("th",null,"New Value")])],-1)),e("tbody",null,[(a(!0),l(S,null,J(R.value,s=>(a(),l("tr",{key:s.key,class:k(s.rowClass)},[e("td",we,d(s.key),1),e("td",Ce,[e("div",Ve,[s.oldIsObject?(a(),l("pre",je,d(s.oldValue),1)):s.oldValue==="—"?(a(),l("span",Ne,"—")):typeof s.oldRaw=="boolean"?(a(),l("span",{key:2,class:k(s.oldRaw?"text-green-400 font-bold":"text-red-400 font-bold")},d(s.oldValue),3)):(a(),l("span",Oe,d(s.oldValue),1))])]),e("td",Re,[e("div",Se,[s.newIsObject?(a(),l("pre",Je,d(s.newValue),1)):s.newValue==="—"?(a(),l("span",De,"—")):typeof s.newRaw=="boolean"?(a(),l("span",{key:2,class:k(s.newRaw?"text-green-400 font-bold":"text-red-400 font-bold")},d(s.newValue),3)):(a(),l("span",Ie,d(s.newValue),1))])])],2))),128)),R.value.length===0?(a(),l("tr",Ae,[...t[17]||(t[17]=[e("td",{colspan:"3",class:"empty-cell"},"No differences found.",-1)])])):V("",!0)])]),e("div",Be,[y(_,{variant:"secondary",onClick:F},{default:b(()=>[...t[20]||(t[20]=[x("Cancel",-1)])]),_:1}),y(_,{onClick:M,loading:w.value},{default:b(()=>[...t[21]||(t[21]=[x("Confirm & Save Changes",-1)])]),_:1},8,["loading"])])])):(a(),l("div",pe,[t[16]||(t[16]=e("div",{class:"flex justify-between items-center mb-6 border-b border-[var(--border-subtle)] pb-4"},[e("h2",{class:"text-lg font-semibold text-primary"},"Key/Value Configuration")],-1)),e("table",me,[t[14]||(t[14]=e("colgroup",null,[e("col",{class:"key-col"}),e("col",{class:"value-col"})],-1)),t[15]||(t[15]=e("thead",null,[e("tr",null,[e("th",null,"Key"),e("th",null,"Value")])],-1)),e("tbody",null,[(a(!0),l(S,null,J(c.value,(s,i)=>(a(),l("tr",{key:i},[e("td",be,d(i),1),e("td",ge,[typeof s=="object"?(a(),l("pre",ye,d(JSON.stringify(s,null,2)),1)):typeof s=="boolean"?(a(),l("span",{key:1,class:k(s?"text-green-400 font-bold":"text-red-400 font-bold")},d(s),3)):(a(),l("span",xe,d(s),1))])]))),128)),Object.keys(c.value).length===0?(a(),l("tr",_e,[...t[13]||(t[13]=[e("td",{colspan:"2",class:"empty-cell"},"No keys defined.",-1)])])):V("",!0)])])]))])]))])}}},Ke=K(Fe,[["__scopeId","data-v-bd0e7908"]]);export{Ke as default};
