import{_ as H,u as J,k as K,j as _,f as O,q as k,c as d,a as o,t,b as i,w as v,l as h,i as j,g as A,p as Q,v as R,F as D,h as I,A as q,d as g,o as m}from"./index-CHWeGoxB.js";import{A as U}from"./AppCard-DwTApDbO.js";import{A as w}from"./AppInput-BQLXc67T.js";import{A as W}from"./AppBadge-CjISbIUR.js";const X={class:"profile-view"},Y={class:"header-section mb-8"},Z={class:"mb-2"},ee={class:"text-secondary"},ae={class:"flex flex-col gap-12"},se={key:0,class:"alert alert-danger mb-4"},le={key:1,class:"alert alert-success mb-4"},te={class:"grid grid-cols-2 gap-4 mb-4"},re={class:"mb-4"},oe={class:"block text-sm font-medium text-secondary mb-1.5"},ue=["value"],ne={key:0,class:"alert alert-danger mb-4"},de={key:1,class:"alert alert-success mb-4"},ie={class:"text-secondary mb-4 text-sm"},me={key:0,class:"p-4 bg-elevated rounded-lg border border-subtle text-secondary text-sm"},ce={key:1,class:"flex flex-col gap-3"},ve={class:"font-medium mb-1"},pe={class:"text-xs text-secondary font-mono"},fe={__name:"ProfileView",setup(be){var S,x,B,L;const r=J(),{setLocale:E,availableLocales:T,locale:P,t:y}=K(),s=_({email:((S=r.user)==null?void 0:S.email)||"",firstName:((x=r.user)==null?void 0:x.first_name)||"",lastName:((B=r.user)==null?void 0:B.last_name)||"",language:((L=r.user)==null?void 0:L.language)||P.value}),p=_({current:"",new:""}),V=_(!1),u=_({error:"",success:"",errors:{}}),$=_(!1),f=_({error:"",success:""}),N=_([]);O(async()=>{var a,l,b,c;await r.fetchUser(),s.value.email=((a=r.user)==null?void 0:a.email)||"",s.value.firstName=((l=r.user)==null?void 0:l.first_name)||"",s.value.lastName=((b=r.user)==null?void 0:b.last_name)||"",s.value.language=((c=r.user)==null?void 0:c.language)||P.value;const e=await k.getMe();e.success&&(N.value=e.b2b_licenses||[])});const z=async()=>{var e,a,l,b;u.value.error="",u.value.success="",u.value.errors={},V.value=!0;try{(await k.updateProfile({first_name:s.value.firstName,last_name:s.value.lastName,language:s.value.language})).success&&(u.value.success=y("common.success"),r.user.first_name=s.value.firstName,r.user.last_name=s.value.lastName,r.user.language=s.value.language,await E(s.value.language))}catch(c){u.value.error=((a=(e=c.response)==null?void 0:e.data)==null?void 0:a.message)||y("common.error"),(b=(l=c.response)==null?void 0:l.data)!=null&&b.errors&&(u.value.errors=c.response.data.errors)}finally{V.value=!1}},G=async()=>{var e,a;f.value.error="",f.value.success="",$.value=!0;try{(await k.updatePassword(p.value.current,p.value.new)).success&&(f.value.success=y("common.success"),p.value.current="",p.value.new="")}catch(l){f.value.error=((a=(e=l.response)==null?void 0:e.data)==null?void 0:a.message)||y("common.error")}finally{$.value=!1}};return(e,a)=>(m(),d("div",X,[o("div",Y,[o("h1",Z,t(e.$t("profile.title")),1),o("p",ee,t(e.$t("profile.info_subtitle")),1)]),o("div",ae,[i(U,null,{header:v(()=>[g(t(e.$t("profile.info_title")),1)]),default:v(()=>{var l,b,c,F,M,C;return[u.value.error?(m(),d("div",se,t(u.value.error),1)):h("",!0),u.value.success?(m(),d("div",le,t(u.value.success),1)):h("",!0),o("form",{onSubmit:j(z,["prevent"]),class:"max-w-md"},[o("div",te,[i(w,{modelValue:s.value.firstName,"onUpdate:modelValue":a[0]||(a[0]=n=>s.value.firstName=n),label:e.$t("common.first_name"),placeholder:((l=A(r).user)==null?void 0:l.first_name)||e.$t("common.first_name"),error:(c=(b=u.value.errors)==null?void 0:b.first_name)==null?void 0:c[0]},null,8,["modelValue","label","placeholder","error"]),i(w,{modelValue:s.value.lastName,"onUpdate:modelValue":a[1]||(a[1]=n=>s.value.lastName=n),label:e.$t("common.last_name"),placeholder:((F=A(r).user)==null?void 0:F.last_name)||e.$t("common.last_name"),error:(C=(M=u.value.errors)==null?void 0:M.last_name)==null?void 0:C[0]},null,8,["modelValue","label","placeholder","error"])]),o("div",re,[o("label",oe,t(e.$t("common.language")),1),Q(o("select",{"onUpdate:modelValue":a[2]||(a[2]=n=>s.value.language=n),class:"w-full bg-elevated border border-subtle rounded-lg p-2.5 text-sm text-primary focus:border-primary outline-none transition-all"},[(m(!0),d(D,null,I(A(T),n=>(m(),d("option",{key:n.code,value:n.code},t(n.flag)+" "+t(n.name),9,ue))),128))],512),[[R,s.value.language]])]),i(w,{modelValue:s.value.email,"onUpdate:modelValue":a[3]||(a[3]=n=>s.value.email=n),label:e.$t("common.email"),type:"email",disabled:""},null,8,["modelValue","label"]),i(q,{type:"submit",loading:V.value,class:"mt-4"},{default:v(()=>[g(t(e.$t("common.save")),1)]),_:1},8,["loading"])],32)]}),_:1}),i(U,null,{header:v(()=>[g(t(e.$t("profile.security_title")),1)]),default:v(()=>[f.value.error?(m(),d("div",ne,t(f.value.error),1)):h("",!0),f.value.success?(m(),d("div",de,t(f.value.success),1)):h("",!0),o("form",{onSubmit:j(G,["prevent"]),class:"max-w-md"},[i(w,{class:"mb-4",modelValue:p.value.current,"onUpdate:modelValue":a[4]||(a[4]=l=>p.value.current=l),label:e.$t("profile.current_password"),type:"password"},null,8,["modelValue","label"]),i(w,{modelValue:p.value.new,"onUpdate:modelValue":a[5]||(a[5]=l=>p.value.new=l),label:e.$t("profile.new_password"),type:"password"},null,8,["modelValue","label"]),i(q,{type:"submit",variant:"secondary",loading:$.value,class:"mt-4"},{default:v(()=>[g(t(e.$t("profile.update_password")),1)]),_:1},8,["loading"])],32)]),_:1}),i(U,null,{header:v(()=>[g(t(e.$t("profile.b2b_licenses")),1)]),default:v(()=>[o("p",ie,t(e.$t("profile.b2b_subtitle")),1),N.value.length===0?(m(),d("div",me,t(e.$t("common.no_data")),1)):(m(),d("div",ce,[(m(!0),d(D,null,I(N.value,l=>(m(),d("div",{key:l.id,class:"p-4 bg-elevated rounded-lg border border-subtle flex justify-between items-center"},[o("div",null,[o("div",ve,t(l.app_instance),1),o("div",pe,t(l.license_number),1)]),i(W,{variant:"success"},{default:v(()=>[g(t(e.$t("dashboard.active")),1)]),_:1})]))),128))]))]),_:1})])]))}},he=H(fe,[["__scopeId","data-v-a3cdd810"]]);export{he as default};
