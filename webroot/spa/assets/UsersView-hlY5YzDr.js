import{u as q,e as G,f as J,c as u,a as s,t as o,b as c,w as p,d as v,A as _,l as g,F as I,h as S,p as j,v as D,j as b,o as i,C as K,x as Q}from"./index-CHWeGoxB.js";import{a as h}from"./admin-CUXU3qYV.js";import{A as x}from"./AppInput-BQLXc67T.js";import{A as M}from"./AppModal-lxvFhGNm.js";const W={class:"admin-users"},X={class:"flex justify-between items-center mb-6"},Y={class:"text-2xl font-bold font-heading"},Z={key:0,class:"bg-red-500/10 border border-red-500/20 text-red-500 p-4 rounded-xl mb-6"},ee={key:1,class:"flex justify-center p-12"},se={key:2,class:"table-card mt-6 mb-6"},ae={class:"table-wrapper"},te={class:"admin-table"},oe={class:"text-right"},le={class:"font-medium text-sm text-primary"},ne={key:0},re={key:1,class:"text-secondary italic"},de={class:"text-sm"},ie={class:"text-xs text-[var(--text-secondary)]"},ue={key:0,class:"badge badge-red"},me={key:1,class:"badge badge-green"},ce={class:"text-right"},pe={class:"flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity"},ve={key:0},fe={colspan:"4",class:"p-8 text-center text-[var(--text-secondary)]"},_e={class:"text-[var(--text-secondary)] mb-6"},be={class:"flex gap-4 justify-end mt-6"},ye={autocomplete:"off",onsubmit:"return false;"},we={class:"mb-4"},ge={class:"block text-sm font-medium text-[var(--text-secondary)] mb-1"},he={class:"form-group mb-4"},ke={class:"form-label"},$e={key:0,class:"form-group mb-8"},Ce={class:"form-label"},Ve={value:null},Ue=["value"],Oe={class:"text-xs text-[var(--text-secondary)] mt-3 mb-2"},xe={class:"mb-6 mt-8 pt-8 border-t border-[var(--border-subtle)]"},Me={class:"text-md font-semibold mb-4"},Ae={class:"block text-sm font-medium text-[var(--text-secondary)] mb-1"},Ee={key:1,class:"alert alert-danger"},Ie={class:"flex gap-4 justify-end mt-6"},Se={autocomplete:"off",onsubmit:"return false;"},je={class:"form-group mb-6"},De={class:"form-label"},Pe={key:0,class:"alert alert-danger"},ze={key:1,class:"alert alert-success"},Be={class:"flex gap-4 justify-end mt-6"},qe={__name:"UsersView",setup(Fe){const P=q(),{t:Ne}=G(),$=b(!0),k=b(""),C=b([]),V=b([]),y=b(null),r=b({isOpen:!1,isEdit:!1,error:"",errors:{},loading:!1}),d=b({id:null,email:"",role:"user",password:"",instance_id:null}),m=b({isOpen:!1,error:"",success:"",errors:{},loading:!1}),w=b({id:null,password:""}),U=async()=>{var e,a;$.value=!0,k.value="";try{const[t,l]=await Promise.all([h.getUsers(),h.getInstances()]);t.success&&(C.value=t.users),l.success&&(V.value=l.instances)}catch(t){k.value=((a=(e=t.response)==null?void 0:e.data)==null?void 0:a.message)||"Failed to load data"}finally{$.value=!1}},z=e=>{y.value=e},B=async()=>{var e,a;if(y.value)try{(await h.deleteUser(y.value.id)).success&&await U()}catch(t){k.value=((a=(e=t.response)==null?void 0:e.data)==null?void 0:a.message)||"Failed to delete user"}finally{y.value=null}},F=async e=>{var a,t,l;try{const n=await h.impersonateUser(e.id);n.success&&(localStorage.getItem("tt_token_stash")||localStorage.setItem("tt_token_stash",localStorage.getItem("tt_token")),localStorage.setItem("tt_token",n.token),P.setAuthData(n.token,n.user,(a=n.user.subscriptions)==null?void 0:a[0]),window.location.href="/dashboard")}catch(n){k.value=((l=(t=n.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to impersonate user"}},N=e=>{r.value={isOpen:!0,isEdit:!0,error:"",errors:{},loading:!1};let a=null;const t=V.value.find(l=>l.club_admin_id===e.id);t&&(a=t.id),d.value={id:e.id,email:e.email,role:e.role,password:"",instance_id:a}},L=()=>{r.value={isOpen:!0,isEdit:!1,error:"",errors:{},loading:!1},d.value={id:null,email:"",role:"user",password:"",instance_id:null}},O=()=>{r.value.isOpen=!1},R=async()=>{var e,a,t,l;r.value.error="",r.value.errors={},r.value.loading=!0;try{if(r.value.isEdit){const n={role:d.value.role,instance_id:d.value.instance_id};d.value.password&&(n.password=d.value.password),await h.updateUser(d.value.id,n)}else await h.createUser({email:d.value.email,password:d.value.password,role:d.value.role,instance_id:d.value.instance_id});O(),await U()}catch(n){r.value.error=((a=(e=n.response)==null?void 0:e.data)==null?void 0:a.message)||"Action failed. Please verify the form inputs.",(l=(t=n.response)==null?void 0:t.data)!=null&&l.errors&&(r.value.errors=n.response.data.errors)}finally{r.value.loading=!1}},T=e=>{m.value={isOpen:!0,error:"",success:"",errors:{},loading:!1},w.value={id:e.id,password:""}},A=()=>{m.value.isOpen=!1},H=async()=>{var e,a,t,l;m.value.error="",m.value.success="",m.value.errors={},m.value.loading=!0;try{await h.updateUser(w.value.id,{password:w.value.password}),m.value.success="Password successfully updated.",w.value.password=""}catch(n){m.value.error=((a=(e=n.response)==null?void 0:e.data)==null?void 0:a.message)||"Password change failed",(l=(t=n.response)==null?void 0:t.data)!=null&&l.errors&&(m.value.errors=n.response.data.errors)}finally{m.value.loading=!1}};return J(()=>{U()}),(e,a)=>(i(),u("div",W,[s("div",X,[s("h1",Y,o(e.$t("admin.users_title")),1),c(_,{onClick:L,size:"sm"},{default:p(()=>[v(o(e.$t("admin.add_user")),1)]),_:1})]),k.value?(i(),u("div",Z,o(k.value),1)):g("",!0),$.value?(i(),u("div",ee,[...a[7]||(a[7]=[s("div",{class:"animate-spin h-8 w-8 border-4 border-[var(--primary)] border-t-transparent rounded-full"},null,-1)])])):(i(),u("div",se,[s("div",ae,[s("table",te,[s("thead",null,[s("tr",null,[s("th",null,o(e.$t("admin.user_table_user")),1),s("th",null,o(e.$t("admin.user_table_role")),1),s("th",null,o(e.$t("admin.user_table_status")),1),s("th",oe,o(e.$t("admin.user_table_actions")),1)])]),s("tbody",null,[(i(!0),u(I,null,S(C.value,t=>(i(),u("tr",{key:t.id,class:"hover:bg-white/5 transition-colors group"},[s("td",null,[s("div",le,[t.first_name||t.last_name?(i(),u("span",ne,o(t.first_name)+" "+o(t.last_name),1)):(i(),u("span",re,o(e.$t("common.no_data")),1))]),s("div",de,o(t.email),1),s("div",ie,o(t.id),1)]),s("td",null,[s("span",{class:K(["badge",{"badge-purple":t.role==="admin","badge-blue":t.role==="club_admin","badge-gray":t.role==="user"}])},o(t.role),3)]),s("td",null,[t.deleted_at?(i(),u("span",ue,o(e.$t("common.delete")),1)):(i(),u("span",me,o(e.$t("dashboard.active")),1))]),s("td",ce,[s("div",pe,[c(_,{variant:"secondary",size:"sm",onClick:l=>F(t)},{default:p(()=>[v(o(e.$t("admin.impersonate")),1)]),_:1},8,["onClick"]),c(_,{variant:"secondary",size:"sm",onClick:l=>T(t)},{default:p(()=>[v(o(e.$t("admin.change_password")),1)]),_:1},8,["onClick"]),c(_,{variant:"secondary",size:"sm",onClick:l=>N(t)},{default:p(()=>[v(o(e.$t("common.edit")),1)]),_:1},8,["onClick"]),t.deleted_at?g("",!0):(i(),Q(_,{key:0,variant:"secondary",size:"sm",onClick:l=>z(t),class:"text-red-400 hover:text-red-300 border-red-500/30 hover:bg-red-500/10"},{default:p(()=>[a[8]||(a[8]=s("svg",{class:"w-4 h-4 mr-2 inline-block",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)),v(" "+o(e.$t("common.delete")),1)]),_:1},8,["onClick"]))])])]))),128)),C.value.length===0?(i(),u("tr",ve,[s("td",fe,o(e.$t("admin.no_users")),1)])):g("",!0)])])])])),c(M,{isOpen:!!y.value,title:e.$t("admin.delete_user"),onClose:a[1]||(a[1]=t=>y.value=null)},{default:p(()=>{var t;return[s("p",_e,[v(o(e.$t("admin.delete_confirm"))+" ",1),s("strong",null,o((t=y.value)==null?void 0:t.email),1),a[9]||(a[9]=v("? They will no longer be able to log in or access the dashboard.",-1))]),s("div",be,[c(_,{variant:"secondary",onClick:a[0]||(a[0]=l=>y.value=null)},{default:p(()=>[v(o(e.$t("common.cancel")),1)]),_:1}),s("button",{onClick:B,class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition-colors"},o(e.$t("common.delete")),1)])]}),_:1},8,["isOpen","title"]),c(M,{isOpen:r.value.isOpen,title:r.value.isEdit?e.$t("admin.edit_user"):e.$t("admin.create_user"),onClose:O},{default:p(()=>{var t,l,n,E;return[s("form",ye,[a[11]||(a[11]=s("input",{style:{display:"none"},type:"text",name:"fakeusernameremembered"},null,-1)),a[12]||(a[12]=s("input",{style:{display:"none"},type:"password",name:"fakepasswordremembered"},null,-1)),s("div",we,[s("label",ge,o(e.$t("common.email")),1),c(x,{modelValue:d.value.email,"onUpdate:modelValue":a[2]||(a[2]=f=>d.value.email=f),type:"text",placeholder:"user@example.com",disabled:r.value.isEdit,autocomplete:"new-password",name:"prevent_autofill_email",id:"prevent_autofill_email",error:(l=(t=r.value.errors)==null?void 0:t.email)==null?void 0:l[0]},null,8,["modelValue","disabled","error"])]),s("div",he,[s("label",ke,o(e.$t("admin.user_table_role")),1),j(s("select",{"onUpdate:modelValue":a[3]||(a[3]=f=>d.value.role=f),class:"form-select",autocomplete:"off",name:"prevent_autofill_role"},[...a[10]||(a[10]=[s("option",{value:"user"},"User",-1),s("option",{value:"club_admin"},"Club Admin",-1),s("option",{value:"admin"},"Super Admin",-1)])],512),[[D,d.value.role]])]),d.value.role==="club_admin"?(i(),u("div",$e,[s("label",Ce,o(e.$t("admin.assign_instance")),1),j(s("select",{"onUpdate:modelValue":a[4]||(a[4]=f=>d.value.instance_id=f),class:"form-select",autocomplete:"off",name:"prevent_autofill_instance"},[s("option",Ve,o(e.$t("common.no_data")),1),(i(!0),u(I,null,S(V.value,f=>(i(),u("option",{key:f.id,value:f.id},o(f.name),9,Ue))),128))],512),[[D,d.value.instance_id]]),s("p",Oe,o(e.$t("admin.instance_help")),1)])):g("",!0),s("div",xe,[s("h4",Me,o(r.value.isEdit?e.$t("admin.change_password"):e.$t("common.password")),1),s("label",Ae,o(r.value.isEdit?e.$t("profile.new_password"):e.$t("common.password")),1),c(x,{modelValue:d.value.password,"onUpdate:modelValue":a[5]||(a[5]=f=>d.value.password=f),type:"password",placeholder:"••••••••",autocomplete:"new-password",name:"prevent_autofill_password",id:"prevent_autofill_password",error:(E=(n=r.value.errors)==null?void 0:n.password)==null?void 0:E[0]},null,8,["modelValue","error"])]),r.value.error?(i(),u("div",Ee,o(r.value.error),1)):g("",!0),s("div",Ie,[c(_,{variant:"secondary",onClick:O,type:"button"},{default:p(()=>[v(o(e.$t("common.cancel")),1)]),_:1}),c(_,{onClick:R,type:"button",loading:r.value.loading},{default:p(()=>[v(o(r.value.isEdit?e.$t("common.save"):e.$t("admin.create_user")),1)]),_:1},8,["loading"])])])]}),_:1},8,["isOpen","title"]),c(M,{isOpen:m.value.isOpen,title:e.$t("admin.change_password"),onClose:A},{default:p(()=>{var t,l;return[s("form",Se,[a[13]||(a[13]=s("input",{style:{display:"none"},type:"text",name:"fakeusernameremembered"},null,-1)),a[14]||(a[14]=s("input",{style:{display:"none"},type:"password",name:"fakepasswordremembered"},null,-1)),s("div",je,[s("label",De,o(e.$t("profile.new_password")),1),c(x,{modelValue:w.value.password,"onUpdate:modelValue":a[6]||(a[6]=n=>w.value.password=n),type:"password",placeholder:"••••••••",autocomplete:"new-password",name:"prevent_autofill_pwd2",id:"prevent_autofill_pwd2",error:(l=(t=m.value.errors)==null?void 0:t.password)==null?void 0:l[0]},null,8,["modelValue","error"])]),m.value.error?(i(),u("div",Pe,o(m.value.error),1)):g("",!0),m.value.success?(i(),u("div",ze,o(e.$t("common.success")),1)):g("",!0),s("div",Be,[c(_,{variant:"secondary",onClick:A,type:"button"},{default:p(()=>[v(o(e.$t("common.cancel")),1)]),_:1}),c(_,{onClick:H,type:"button",disabled:!w.value.password,loading:m.value.loading},{default:p(()=>[v(o(e.$t("common.save")),1)]),_:1},8,["disabled","loading"])])])]}),_:1},8,["isOpen","title"])]))}};export{qe as default};
