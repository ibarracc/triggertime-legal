import{_ as F,f as U,c as l,a as t,b as c,w as p,d as m,A as y,t as f,l as b,F as D,h as E,p as h,v as $,y as z,G as T,j as g,o}from"./index-CHWeGoxB.js";import{a as _}from"./admin-CUXU3qYV.js";import{A as I}from"./AppModal-lxvFhGNm.js";const L={class:"admin-versions"},G={class:"flex justify-between items-center mb-6"},H={key:0,class:"bg-red-500/10 border border-red-500/20 text-red-500 p-4 rounded-xl mb-6"},R={key:1,class:"flex justify-center p-12"},q={key:2,class:"table-card mt-6 mb-6"},J={class:"table-wrapper"},K={class:"admin-table"},P={class:"font-medium text-sm text-primary"},Q={class:"font-medium text-secondary"},W={key:0,class:"badge badge-green"},X={key:1,class:"badge badge-gray"},Y={class:"p-4 text-right"},Z={class:"flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity"},ee={key:0},te={class:"text-[var(--text-secondary)] mb-6"},se={class:"flex gap-3 justify-end mt-4"},ae={key:0,class:"alert alert-danger"},ne={class:"form-group"},le=["value"],oe={key:0,class:"text-red-500 text-xs mt-1"},re={class:"form-group mt-4"},ie={key:0,class:"text-red-500 text-xs mt-1"},de={class:"mb-4 mt-4 flex items-center gap-2"},ue={class:"flex gap-3 justify-end mt-6"},ve={__name:"VersionsView",setup(ce){const k=g(!0),x=g(""),V=g([]),A=g([]),v=g(null),a=g({isOpen:!1,isEdit:!1,error:"",errors:{},loading:!1}),d=g({id:null,instance_id:null,version:"",active:!0}),w=async()=>{var n,e;k.value=!0,x.value="";try{const s=await _.getVersions();s.success&&(V.value=s.versions);const i=await _.getInstances();i.success&&(A.value=i.instances)}catch(s){x.value=((e=(n=s.response)==null?void 0:n.data)==null?void 0:e.message)||"Failed to load versions"}finally{k.value=!1}},N=n=>{v.value=n},O=async()=>{var n,e;if(v.value)try{(await _.deleteVersion(v.value.id)).success&&await w()}catch(s){x.value=((e=(n=s.response)==null?void 0:n.data)==null?void 0:e.message)||"Failed to delete version"}finally{v.value=null}},S=n=>{d.value={id:n.id,instance_id:n.instance_id,version:n.version,active:!n.disabled},a.value={isOpen:!0,isEdit:!0,error:"",errors:{},loading:!1}},B=()=>{d.value={id:null,instance_id:null,version:"",active:!0},a.value={isOpen:!0,isEdit:!1,error:"",errors:{},loading:!1}},C=()=>{a.value.isOpen=!1},j=async()=>{var n,e,s,i;a.value.error="",a.value.errors={},a.value.loading=!0;try{const r={...d.value};r.disabled=!r.active,delete r.active,a.value.isEdit?await _.updateVersion(r.id,r):await _.createVersion(r),C(),await w()}catch(r){a.value.error=((e=(n=r.response)==null?void 0:n.data)==null?void 0:e.message)||"Action failed",(i=(s=r.response)==null?void 0:s.data)!=null&&i.errors&&(a.value.errors=r.response.data.errors)}finally{a.value.loading=!1}};return U(()=>{w()}),(n,e)=>(o(),l("div",L,[t("div",G,[e[6]||(e[6]=t("h1",{class:"text-2xl font-bold font-heading"},"App Versions",-1)),c(y,{onClick:B,size:"sm"},{default:p(()=>[...e[5]||(e[5]=[m("Add Version",-1)])]),_:1})]),x.value?(o(),l("div",H,f(x.value),1)):b("",!0),k.value?(o(),l("div",R,[...e[7]||(e[7]=[t("div",{class:"animate-spin h-8 w-8 border-4 border-[var(--primary)] border-t-transparent rounded-full"},null,-1)])])):(o(),l("div",q,[t("div",J,[t("table",K,[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",null,"Instance"),t("th",null,"Version Name"),t("th",null,"Status"),t("th",{class:"text-right"},"Actions")])],-1)),t("tbody",null,[(o(!0),l(D,null,E(V.value,s=>(o(),l("tr",{key:s.id,class:"hover:bg-white/5 transition-colors group"},[t("td",null,[t("div",P,f(s.instance?s.instance.name:"Unknown Instance"),1)]),t("td",null,[t("div",Q,f(s.version),1)]),t("td",null,[s.disabled?(o(),l("span",X,"Inactive")):(o(),l("span",W,"Active"))]),t("td",Y,[t("div",Z,[c(y,{variant:"secondary",size:"sm",onClick:i=>S(s)},{default:p(()=>[...e[8]||(e[8]=[m("Edit",-1)])]),_:1},8,["onClick"]),c(y,{variant:"secondary",size:"sm",onClick:i=>N(s),class:"text-red-400 hover:text-red-300 border-red-500/30 hover:bg-red-500/10"},{default:p(()=>[...e[9]||(e[9]=[t("svg",{class:"w-4 h-4 mr-2 inline-block",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),m(" Delete ",-1)])]),_:1},8,["onClick"])])])]))),128)),V.value.length===0?(o(),l("tr",ee,[...e[10]||(e[10]=[t("td",{colspan:"5",class:"p-8 text-center text-secondary"},"No versions found.",-1)])])):b("",!0)])])])])),c(I,{isOpen:!!v.value,title:"Delete Version",onClose:e[1]||(e[1]=s=>v.value=null)},{default:p(()=>{var s;return[t("p",te,[e[12]||(e[12]=m("Are you sure you want to delete version ",-1)),t("strong",null,f((s=v.value)==null?void 0:s.version),1),e[13]||(e[13]=m("? This might affect remote configs linked to it.",-1))]),t("div",se,[c(y,{variant:"secondary",onClick:e[0]||(e[0]=i=>v.value=null)},{default:p(()=>[...e[14]||(e[14]=[m("Cancel",-1)])]),_:1}),t("button",{onClick:O,class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium transition-colors"}," Confirm Delete ")])]}),_:1},8,["isOpen"]),c(I,{isOpen:a.value.isOpen,title:a.value.isEdit?"Edit Version":"Create Version",onClose:C},{default:p(()=>{var s,i,r,M;return[a.value.error?(o(),l("div",ae,f(a.value.error),1)):b("",!0),t("div",ne,[e[16]||(e[16]=t("label",{class:"form-label"},"Instance",-1)),h(t("select",{"onUpdate:modelValue":e[2]||(e[2]=u=>d.value.instance_id=u),class:"form-select text-black"},[e[15]||(e[15]=t("option",{value:null},"-- Select Instance --",-1)),(o(!0),l(D,null,E(A.value,u=>(o(),l("option",{key:u.id,value:u.id},f(u.name),9,le))),128))],512),[[$,d.value.instance_id]]),(i=(s=a.value.errors)==null?void 0:s.instance_id)!=null&&i[0]?(o(),l("div",oe,f(a.value.errors.instance_id[0]),1)):b("",!0)]),t("div",re,[e[17]||(e[17]=t("label",{class:"form-label"},"Version Name",-1)),h(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=u=>d.value.version=u),placeholder:"1.0.0",class:"form-input"},null,512),[[z,d.value.version]]),(M=(r=a.value.errors)==null?void 0:r.version)!=null&&M[0]?(o(),l("div",ie,f(a.value.errors.version[0]),1)):b("",!0)]),t("div",de,[h(t("input",{type:"checkbox",id:"active","onUpdate:modelValue":e[4]||(e[4]=u=>d.value.active=u),class:"w-4 h-4 rounded bg-[var(--bg-card)] border-[var(--border-subtle)] focus:ring-[var(--primary)] text-[var(--primary)]"},null,512),[[T,d.value.active]]),e[18]||(e[18]=t("label",{for:"active",class:"text-sm font-medium text-[var(--text-primary)]"},"Active",-1))]),t("div",ue,[c(y,{variant:"secondary",onClick:C},{default:p(()=>[...e[19]||(e[19]=[m("Cancel",-1)])]),_:1}),c(y,{onClick:j,loading:a.value.loading},{default:p(()=>[...e[20]||(e[20]=[m("Save Changes",-1)])]),_:1},8,["loading"])])]}),_:1},8,["isOpen","title"])]))}},ge=F(ve,[["__scopeId","data-v-62540152"]]);export{ge as default};
