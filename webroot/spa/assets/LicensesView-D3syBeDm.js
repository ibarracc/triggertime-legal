import{f as z,c as n,a as t,p as F,v as T,F as S,h as E,b as u,w as b,d as g,A as y,t as c,l as D,j as r,D as J,o}from"./index-CHWeGoxB.js";import{a as A}from"./admin-CUXU3qYV.js";import{A as N}from"./AppInput-BQLXc67T.js";import{A as P}from"./AppModal-lxvFhGNm.js";const q={class:"admin-licenses"},G={class:"flex flex-row justify-between items-center gap-4 mb-8"},H={class:"flex-1 max-w-[300px]"},K=["value"],Q={class:"flex items-center gap-3"},W={key:0,class:"bg-red-500/10 border border-red-500/20 text-red-500 p-4 rounded-xl mb-6"},X={key:1,class:"flex justify-center p-12"},Y={key:2,class:"table-card mt-6 mb-6"},Z={class:"table-wrapper"},ee={class:"admin-table"},te={class:"font-mono text-sm tracking-wider text-primary"},se={class:"font-medium"},ae={class:"text-xs text-secondary"},le={class:"text-sm"},ne={key:0,class:"badge badge-red"},oe={key:1,class:"badge badge-blue"},ie={key:2,class:"badge badge-green"},re={class:"text-right"},de={class:"flex items-center justify-end gap-2 opacity-0 group-hover:opacity-100 transition-opacity"},ue={key:0},ce={colspan:"5",class:"p-8 text-center text-secondary"},me={key:0,class:"alert alert-danger"},ve={class:"form-group"},pe={class:"form-group mb-6"},fe={class:"flex gap-3 justify-end mt-4"},ke={__name:"LicensesView",setup(be){const L=r(!0),h=r(""),x=r([]),j=r([]),C=r(""),m=r(null),v=r({name:"",email:""}),_=r(""),k=r({}),V=r(!1),w=J(()=>C.value?x.value.filter(a=>a.instance_id===C.value):x.value),$=async()=>{var a,e;L.value=!0,h.value="";try{const[s,l]=await Promise.all([A.getLicenses(),A.getInstances()]);s.success&&(x.value=s.licenses),l.success&&(j.value=l.instances)}catch(s){h.value=((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.message)||"Failed to load data"}finally{L.value=!1}},I=async a=>{var e,s;try{(await A.toggleLicenseAccess(a.id)).success&&(a.deleted_at=a.deleted_at?null:new Date().toISOString())}catch(l){h.value=((s=(e=l.response)==null?void 0:e.data)==null?void 0:s.message)||"Failed to toggle status"}},B=a=>{_.value="",k.value={},m.value=a,v.value={name:a.name||"",email:a.email||""}},R=async()=>{var a,e,s,l;_.value="",k.value={},V.value=!0;try{(await A.updateLicense(m.value.id,v.value)).success&&(m.value.name=v.value.name,m.value.email=v.value.email,m.value=null)}catch(i){_.value=((e=(a=i.response)==null?void 0:a.data)==null?void 0:e.message)||"Update failed",(l=(s=i.response)==null?void 0:s.data)!=null&&l.errors&&(k.value=i.response.data.errors)}finally{V.value=!1}},U=()=>{var f;if(w.value.length===0)return;const e=[["Email","Name","License Number","Instance Name","Status","Claimed At"].join(",")];for(const p of w.value){const M=p.deleted_at?"Disabled":p.used?"Claimed":"Ready",O=[`"${p.email||""}"`,`"${p.name||""}"`,p.license_number,`"${((f=p.instance)==null?void 0:f.name)||""}"`,M,p.used?`"${new Date(p.used).toLocaleString()}"`:""];e.push(O.join(","))}const s=e.join(`
`),l=new Blob([s],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(l),d=document.createElement("a");d.setAttribute("href",i),d.setAttribute("download",`licenses_export_${new Date().toISOString().split("T")[0]}.csv`),d.style.visibility="hidden",document.body.appendChild(d),d.click(),document.body.removeChild(d)};return z(()=>{$()}),(a,e)=>(o(),n("div",q,[e[16]||(e[16]=t("h1",{class:"text-2xl font-bold font-heading mb-6"},"Activation Licenses",-1)),t("div",G,[t("div",H,[F(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>C.value=s),class:"form-select w-full"},[e[6]||(e[6]=t("option",{value:""},"All Instances",-1)),(o(!0),n(S,null,E(j.value,s=>(o(),n("option",{key:s.id,value:s.id},c(s.name),9,K))),128))],512),[[T,C.value]])]),t("div",Q,[u(y,{variant:"secondary",onClick:U,size:"sm",disabled:w.value.length===0},{default:b(()=>[...e[7]||(e[7]=[t("svg",{class:"w-4 h-4 mr-2 inline-block",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),g(" Download CSV ",-1)])]),_:1},8,["disabled"]),u(y,{onClick:e[1]||(e[1]=s=>a.$router.push("/admin/licenses/import")),size:"sm"},{default:b(()=>[...e[8]||(e[8]=[t("svg",{class:"w-4 h-4 mr-2 inline-block",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})],-1),g(" Import CSV ",-1)])]),_:1})])]),h.value?(o(),n("div",W,c(h.value),1)):D("",!0),L.value?(o(),n("div",X,[...e[9]||(e[9]=[t("div",{class:"animate-spin h-8 w-8 border-4 border-[var(--primary)] border-t-transparent rounded-full"},null,-1)])])):(o(),n("div",Y,[t("div",Z,[t("table",ee,[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",null,"License"),t("th",null,"Customer"),t("th",null,"Instance"),t("th",null,"Status"),t("th",{class:"text-right"},"Actions")])],-1)),t("tbody",null,[(o(!0),n(S,null,E(w.value,s=>{var l;return o(),n("tr",{key:s.id,class:"hover:bg-white/5 transition-colors group"},[t("td",null,[t("div",te,c(s.license_number),1)]),t("td",null,[t("div",se,c(s.name||"N/A"),1),t("div",ae,c(s.email),1)]),t("td",null,[t("div",le,c(((l=s.instance)==null?void 0:l.name)||"Unknown"),1)]),t("td",null,[s.deleted_at?(o(),n("span",ne,"Disabled")):s.used?(o(),n("span",oe,"Claimed")):(o(),n("span",ie,"Ready"))]),t("td",re,[t("div",de,[u(y,{variant:"secondary",size:"sm",onClick:i=>I(s)},{default:b(()=>[g(c(s.deleted_at?"Enable":"Disable"),1)]),_:2},1032,["onClick"]),u(y,{variant:"secondary",size:"sm",onClick:i=>B(s)},{default:b(()=>[...e[10]||(e[10]=[g(" Edit ",-1)])]),_:1},8,["onClick"])])])])}),128)),w.value.length===0?(o(),n("tr",ue,[t("td",ce,c(x.value.length===0?"No licenses found.":"No licenses match this filter."),1)])):D("",!0)])])])])),u(P,{isOpen:!!m.value,title:"Edit License",onClose:e[5]||(e[5]=s=>m.value=null)},{default:b(()=>{var s,l,i,d;return[_.value?(o(),n("div",me,c(_.value),1)):D("",!0),t("div",ve,[e[12]||(e[12]=t("label",{class:"form-label"},"Customer Name",-1)),u(N,{modelValue:v.value.name,"onUpdate:modelValue":e[2]||(e[2]=f=>v.value.name=f),placeholder:"John Doe",error:(l=(s=k.value)==null?void 0:s.name)==null?void 0:l[0]},null,8,["modelValue","error"])]),t("div",pe,[e[13]||(e[13]=t("label",{class:"form-label"},"Customer Email",-1)),u(N,{modelValue:v.value.email,"onUpdate:modelValue":e[3]||(e[3]=f=>v.value.email=f),type:"email",placeholder:"john@example.com",error:(d=(i=k.value)==null?void 0:i.email)==null?void 0:d[0]},null,8,["modelValue","error"])]),t("div",fe,[u(y,{variant:"secondary",onClick:e[4]||(e[4]=f=>m.value=null)},{default:b(()=>[...e[14]||(e[14]=[g("Cancel",-1)])]),_:1}),u(y,{onClick:R,loading:V.value},{default:b(()=>[...e[15]||(e[15]=[g("Save Changes",-1)])]),_:1},8,["loading"])])]}),_:1},8,["isOpen"])]))}};export{ke as default};
